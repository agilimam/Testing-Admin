<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemesanan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/public/css/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .container {
            padding-bottom: 100px;
        }
        footer {
            flex-shrink: 0;
        }
        .form-card {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .hidden {
            display: none;
        }

        .service-option {
            display: none;
        }
        #loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8); /* Warna putih dengan transparansi */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            color: #343a40;
        }

        header p {
            font-size: 1.25rem;
            color: #6c757d;
        }

        .text-center-awal .btn-primary {
            padding: 10px 20px;
            font-size: 1.2rem;
            border-radius: 8px;
        }

        .btn-primary a {
            color: #fff;
        }

        .text-center-awal {
            justify-content: center;
            text-align: center;
        }

        .hero {
            margin-bottom: 80px;
        }

        .hero h1 {
            margin-bottom: 20px;
            font-weight: bolder;
            font-size: 3.5rem;
            color: #5a4633;
        }

        .hero p {
            margin-bottom: 15px;
            color: #555;
        }

        .hero a {
            color: #007bff;
            text-decoration: none;
        }

        .hero a:hover {
            text-decoration: underline;
        }

        .how-to-order{
            margin-bottom: 80px;
        }

        .how-to-order h2,
        .why-choose-us h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #6b3900;
            font-weight: bold;
        }

        .how-to-order ul {
            list-style: none;
            padding: 0;
        }

        .how-to-order li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 30px;
        }

        .how-to-order li::before {
            content: 'ðŸŒŸ';
            position: absolute;
            left: 0;
            top: 0;
            font-size: 1.2rem;
        }

        .why-choose-us .features {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .feature {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .feature img {
            max-width: 50px;
            margin-bottom: 15px;
        }

        .feature h3 {
            font-size: 1.1rem;
            color: #333;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/user/home">
                <img src="/public/images/logo2.png" alt="Website Logo" style="height: 60px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link <%= showNavbar && currentPage === 'home' ? 'active' : '' %>" href="/user/home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link <%= showNavbar && currentPage === 'pesanan' ? 'active' : '' %>" href="/pesanan">Pesanan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link <%= showNavbar && currentPage === 'about' ? 'active' : '' %>" href="/about">About</a>
                    </li>
                    <!-- Tombol logout di pojok kanan dengan ikon -->
                    <li class="nav-item ms-auto">
                        <form action="<%= url %>login/logout" class="d-inline">
                            <button class="btn btn-link nav-link" type="submit">
                                <i class="fas fa-sign-out-alt logout-icon"></i> Sign Out
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Elemen loading -->
    <div id="loading" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container">
        <section class="hero">
            <h1>Langsung Menuju ke Rumah</h1>
            <p>MyPet hadir untuk menyediakan dokter hewan yang akan membantu dan menjadi solusi dengan menyediakan layanan kesehatan dan perawatan hewan kesayangan bagi para pecinta hewan. MyPet menyediakan berbagai layanan dokter hewan yang profesional dan berpengalaman. Saat ini kami memiliki layanan perawatan hewan, dan Penitipan hewan Anda. Seluruh pelayanan tersebut bisa langsung didapatkan di rumah atau lokasi Anda hanya dengan kami dengan cepat dan mudah.</p>
        </section>

        <section class="how-to-order">
            <h2>Langsung Pesan Sekarang, Tunggu Apalagi?</h2>
            <ul>
                <li>Pesan melalui Web Order MyPet.</li>
                <li>MyPet akan mencarikan dokter hewan terdekat dari lokasi Anda.</li>
                <li>Dokter hewan terdekat dari lokasi Anda akan datang.</li>
            </ul>
        </section>

        <section class="why-choose-us">
            <h2>Mengapa Pesan di MyPet?</h2>
            <div class="features">
                <div class="feature">
                    <img src="/public/images/kucingpesan.png" alt="Icon 1">
                    <h3>Perawatan hewan berpengalaman dan terpercaya</h3>
                </div>
                <div class="feature">
                    <img src="/public/images/kucingpesan2.png" alt="Icon 2">
                    <h3>Layanan dokter hewan cepat dan mudah dari rumah</h3>
                </div>
                <div class="feature">
                    <img src="/public/images/kucingpesan3.png" alt="Icon 3">
                    <h3>Dokter hewan memberikan kenyamanan pada hewan kesayangan</h3>
                </div>
                <div class="feature">
                    <img src="/public/images/kucingpesan4.png" alt="Icon 4">
                    <h3>Pesan dan pembayaran layanan dokter hewan dengan mudah dan transparan</h3>
                </div>
            </div>
        </section>
    </div>

    <div class="container mt-5">
        <header class="text-center-awal mb-5">
            <h1>Ayo Pesan Sekarang!</h1>
            <p class="lead">Berikan yang terbaik untuk hewan kesayangan Anda dengan layanan penitipan dan perawatan terbaik dari kami.</p>
            <p>Dengan harga yang terjangkau dan layanan profesional, kami hadir untuk memenuhi kebutuhan Anda.</p>
            <a href="#orderForm" class="btn btn-primary">Pesan Sekarang</a>
        </header>
    </div>


    <div class="container mt-5">
        <header class="text-center mb-5">
            <h1>Daftar Pesanan Anda</h1>
        </header>
    
        <!-- Tabel Daftar Pesanan -->
        <div class="table-responsive">
            <% if (pesanan.length > 0) { %>
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>ID Pesanan</th>
                            <th>Layanan</th>
                            <th>Tanggal Masuk</th>
                            <th>Tanggal Keluar</th>
                            <th>Status</th>
                            <th>Total Harga</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <% pesanan.forEach(order => { %>
                            <tr>
                                <td><%= order.id_pesanan %></td>
                                <td><%= order.jenis_pelayanan %></td>
                                <td><%= new Date(order.tgl_masuk).toISOString().split('T')[0] %></td>
                                <td><%= new Date(order.tgl_keluar).toISOString().split('T')[0] %></td>
                                <td><%= order.status %></td>
                                <td>Rp <%= order.total_harga ? order.total_harga.toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00' %></td>
                                <td>
                                    <button class="btn btn-primary" onclick="showOrderDetails('<%= order.id_pesanan %>')">Detail</button>
                                    <% if (order.status === 'success') { %>
                                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#cancelReasonModal" data-order-id="<%= order.id_pesanan %>">Batalkan</button>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            <% } else { %>
                <p class="text-center">Anda tidak memiliki pesanan apapun.</p>
            <% } %>
        </div>
    </div>

    <!-- Modal untuk menampilkan detail pesanan -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="orderDetailsModalLabel">Detail Pesanan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Tanggal Pesanan:</strong> <span id="modalOrderDate"></span></p>
                    <p><strong>Tanggal Masuk:</strong> <span id="modalCheckInDate"></span></p>
                    <p><strong>Tanggal Keluar:</strong> <span id="modalCheckOutDate"></span></p>
                    <p><strong>Jenis Pelayanan:</strong> <span id="modalServiceType"></span></p>
                    <p><strong>Tipe Layanan:</strong> <span id="modalTipeLayanan"></span></p>
                    <p><strong>Jenis Hewan:</strong> <span id="modalAnimalType"></span></p>
                    <p><strong>Spesies:</strong> <span id="modalSpecies"></span></p>
                    <p><strong>Jumlah:</strong> <span id="modalQuantity"></span></p>
                    <p><strong>No Telp:</strong> <span id="modalPhone"></span></p>
                    <p><strong>Alamat:</strong> <span id="modalAddress"></span></p>
                    <p><strong>Pesan:</strong> <span id="modalMessage"></span></p>
                    <p><strong>Total Harga:</strong> <span id="modalTotalPrice"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

     <!-- Modal for cancellation reason -->
     <div class="modal fade" id="cancelReasonModal" tabindex="-1" aria-labelledby="cancelReasonModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cancelReasonModalLabel">Alasan Pembatalan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cancelReasonForm">
                        <div class="mb-3">
                            <label for="cancelReason" class="form-label">Alasan</label>
                            <textarea class="form-control" id="cancelReason" name="cancelReason" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-danger">Batalkan Pesanan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <header class="text-center mb-5">
            <h1>Pemesanan</h1>
            <p class="lead">Isi formulir di bawah ini untuk memesan layanan kami.</p>
        </header>
        <div class="form-card">
            <form id="orderForm" action="javascript:void(0);">
                <div class="mb-3">
                    <label for="orderDate" class="form-label">Tanggal Pesanan</label>
                    <input type="date" class="form-control" id="orderDate" name="orderDate" required readonly>
                </div>
                <div class="mb-3">
                    <label for="checkInDate" class="form-label">Tanggal Masuk</label>
                    <input type="date" class="form-control" id="checkInDate" name="checkInDate" required>
                </div>
                <div class="mb-3">
                    <label for="checkOutDate" class="form-label">Tanggal Keluar</label>
                    <input type="date" class="form-control" id="checkOutDate" name="checkOutDate" required>
                </div>
                <div class="mb-3">
                    <label for="serviceType" class="form-label">Pilih Jenis Pelayanan</label>
                    <select class="form-control" id="serviceType" name="serviceType" required>
                        <option value="" disabled selected>Jenis Layanan</option>
                        <option value="Penitipan">Penitipan</option>
                        <option value="Perawatan">Perawatan</option>
                    </select>
                </div>
                <div id="perawatanOptions" class="service-option mb-3">
                    <h3>Perawatan</h3>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="perawatanA" value="A" data-price="750000.00">
                        <label class="form-check-label" for="perawatanA">
                            Tipe A - Rp 750.000
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="perawatanB" value="B" data-price="500000.00">
                        <label class="form-check-label" for="perawatanB">
                            Tipe B - Rp 500.000
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="perawatanC" value="C" data-price="250000.00">
                        <label class="form-check-label" for="perawatanC">
                            Tipe C - Rp 250.000
                        </label>
                    </div>
                </div>
                <div id="penitipanOptions" class="service-option mb-3">
                    <h3>Penitipan</h3>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="penitipanA" value="A" data-price="750000.00">
                        <label class="form-check-label" for="penitipanA">
                            Tipe A - Rp 750.000
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="penitipanB" value="B" data-price="500000.00">
                        <label class="form-check-label" for="penitipanB">
                            Tipe B - Rp 500.000
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipeLayanan" id="penitipanC" value="C" data-price="250000.00">
                        <label class="form-check-label" for="penitipanC">
                            Tipe C - Rp 250.000
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="animalType" class="form-label">Jenis Hewan</label>
                    <select class="form-control" id="animalType" name="animalType" required>
                        <option value="" disabled selected>Pilih Jenis Hewan</option>
                        <option value="Anjing">Anjing</option>
                        <option value="Kucing">Kucing</option>
                        <option value="Monyet">Monyet</option>
                        <option value="Burung">Burung</option>
                        <option value="Ayam">Ayam</option>
                        <option value="Ikan">Ikan</option>
                        <option value="Ular">Ular</option>
                        <option value="Hamster">Hamster</option>
                        <option value="Marmut">Marmut</option>
                        <option value="Kelinci">Kelinci</option>
                        <option value="Kura-kura">Kura-kura</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="species" class="form-label">Spesies</label>
                    <input type="text" class="form-control" id="species" name="species" placeholder="Masukkan Nama Spesies" required>
                </div>
                <div class="mb-3">
                    <label for="quantity" class="form-label">Jumlah</label>
                    <input type="number" class="form-control" id="quantity" name="quantity" placeholder="Masukkan Jumlah Hewan" required>
                </div>
                <div class="mb-3">
                    <label for="phone" class="form-label">No Telp</label>
                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Masukkan Nomor Telp" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Alamat</label>
                    <input type="text" class="form-control" id="address" name="address" placeholder="Masukkan Alamat Anda" required>
                </div>
                <div class="mb-3">
                    <label for="message" class="form-label">Pesan (Opsional)</label>
                    <textarea class="form-control" id="message" name="message" placeholder="Pesan untuk kebutuhan hewan Anda. Kosongkan jika tidak ada" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Konfirmasi</button>
            </form>
        </div>
    </div>

    <div class="container mt-5 hidden" id="orderDetails">
        <header class="text-center mb-5">
            <h1>Detail Pesanan</h1>
            <p class="lead">Periksa detail pesanan Anda di bawah ini.</p>
        </header>
        <div class="form-card">
            <div class="mb-3">
                <label class="form-label">Tanggal Pesanan</label>
                <p id="detailOrderDate"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Tanggal Masuk</label>
                <p id="detailCheckInDate"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Tanggal Keluar</label>
                <p id="detailCheckOutDate"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Jenis Pelayanan</label>
                <p id="detailServiceType"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Tipe Layanan</label>
                <p id="detailTipeLayanan"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Jenis Hewan</label>
                <p id="detailAnimalType"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Spesies</label>
                <p id="detailSpecies"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Jumlah</label>
                <p id="detailQuantity"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">No Telp</label>
                <p id="detailPhone"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Alamat</label>
                <p id="detailAddress"></p>
            </div>
            <div class="mb-3">
                <label class="form-label">Pesan</label>
                <p id="detailMessage"></p>
            </div>
            <div class="mb-3">
                <label for="totalPrice" class="form-label">Total Harga</label>
                <input type="text" class="form-control" id="totalPrice" name="totalPrice" readonly>
            </div>
            <button class="btn btn-primary" id="proceedToPayment">Konfirmasi dan Bayar</button>
            <button class="btn btn-secondary" id="cancelOrder">Batal Pesanan</button>
        </div>
    </div>

    <div class="container mt-5 hidden" id="paymentSection">
        <header class="text-center mb-5">
            <h1>Pembayaran</h1>
            <p class="lead">Lakukan pembayaran dalam waktu 10 menit.</p>
        </header>
        <div class="form-card">
            <p id="startCountdown"></p>
            <p>Total: <span id="paymentTotal"></span></p>
            <button class="btn btn-primary" id="confirmPayment">Konfirmasi Bayar</button>
            <button class="btn btn-secondary" id="cancelPayment">Batal Pembayaran</button>
        </div>
    </div>

    <footer class="footer text-center py-3 mt-5">
        <p>&copy; 2024 MyPet by Kelompok 5. Hak cipta dilindungi undang-undang.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const logoutForm = document.querySelector('form[action*="logout"]');
            logoutForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Mencegah pengiriman form langsung
                document.getElementById('loading').style.display = 'flex';
                setTimeout(() => {
                    logoutForm.submit(); // Mengirim form setelah penundaan
                }, 2000); // Penundaan 2 detik (2000 milidetik)
            });
        });

        document.getElementById('serviceType').addEventListener('change', function() {
            var perawatanOptions = document.getElementById('perawatanOptions');
            var penitipanOptions = document.getElementById('penitipanOptions');
            perawatanOptions.style.display = 'none';
            penitipanOptions.style.display = 'none';
            if (this.value === 'Perawatan') {
                perawatanOptions.style.display = 'block';
            } else if (this.value === 'Penitipan') {
                penitipanOptions.style.display = 'block';
            }
        });
    
        document.querySelectorAll('input[name="tipeLayanan"]').forEach(function(element) {
            element.addEventListener('change', function() {
                var selectedPrice = document.querySelector('input[name="tipeLayanan"]:checked').getAttribute('data-price');
                document.getElementById('totalPrice').value = 'Rp ' + parseFloat(selectedPrice).toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            });
        });
    
        document.getElementById('proceedToPayment').addEventListener('click', function() {
            var totalPrice = document.getElementById('totalPrice').value;
            if (totalPrice) {
                document.getElementById('paymentTotal').innerText = totalPrice;
                document.getElementById('paymentSection').classList.remove('hidden');
                document.getElementById('orderDetails').classList.add('hidden');
                startCountdown();
            } else {
                alert('Silakan pilih tipe layanan terlebih dahulu.');
            }
        });
    
        document.getElementById('cancelOrder').addEventListener('click', function() {
            document.getElementById('orderDetails').classList.add('hidden');
            document.getElementById('orderForm').classList.remove('hidden');
        });
    
        document.getElementById('cancelPayment').addEventListener('click', function() {
            if (confirm('Apakah Anda yakin ingin membatalkan pembayaran?')) {
                document.getElementById('paymentSection').classList.add('hidden');
                document.getElementById('orderDetails').classList.remove('hidden');
            }
        });
    
        document.getElementById('confirmPayment').addEventListener('click', function() {
            if (confirm('Apakah Anda yakin ingin melakukan pembayaran? Anda tidak dapat membatalkan pembayaran setelah ini. Harap pastikan data yang Anda masukkan sudah benar.')) {
                // Simpan data ke database
                const formData = new FormData(document.getElementById('orderForm'));
                const data = {};
                formData.forEach((value, key) => {
                    data[key] = value;
                });
                data.status = 'success'; // Update status to success
                fetch('/pesanan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => {
                    if (response.ok) {
                        alert('Pembayaran berhasil!');
                        window.location.href = '/pesanan';
                    } else {
                        alert('Pembayaran gagal, silakan coba lagi.');
                    }
                });
            }
        });
    
        function startCountdown() {
            let countdown = 600; // 10 menit dalam detik
            const countdownElement = document.getElementById('startCountdown');
            const interval = setInterval(() => {
                const minutes = Math.floor(countdown / 60);
                const seconds = countdown % 60;
                countdownElement.innerText = `Waktu tersisa: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                countdown--;
                if (countdown < 0) {
                    clearInterval(interval);
                    alert('Waktu pembayaran telah habis.');
                    document.getElementById('paymentSection').classList.add('hidden');
                    document.getElementById('orderDetails').classList.remove('hidden');
                }
            }, 1000);
        }
    
        document.getElementById('orderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            document.getElementById('orderDetails').classList.remove('hidden');
            document.getElementById('orderForm').classList.add('hidden');
            document.getElementById('detailOrderDate').innerText = document.getElementById('orderDate').value;
            document.getElementById('detailCheckInDate').innerText = document.getElementById('checkInDate').value;
            document.getElementById('detailCheckOutDate').innerText = document.getElementById('checkOutDate').value;
            document.getElementById('detailServiceType').innerText = document.getElementById('serviceType').value;
            document.getElementById('detailTipeLayanan').innerText = document.querySelector('input[name="tipeLayanan"]:checked').value;
            document.getElementById('detailAnimalType').innerText = document.getElementById('animalType').value;
            document.getElementById('detailSpecies').innerText = document.getElementById('species').value;
            document.getElementById('detailQuantity').innerText = document.getElementById('quantity').value;
            document.getElementById('detailPhone').innerText = document.getElementById('phone').value;
            document.getElementById('detailAddress').innerText = document.getElementById('address').value;
            document.getElementById('detailMessage').innerText = document.getElementById('message').value;
            document.getElementById('totalPrice').value = 'Rp ' + parseInt(document.querySelector('input[name="tipeLayanan"]:checked').getAttribute('data-price')).toLocaleString('id-ID');
        });
    
        function showOrderDetails(orderId) {
            fetch(`/pesanan/${orderId}`)
                .then(response => response.json())
                .then(data => {
                    const formatDate = (dateString) => {
                        const date = new Date(dateString);
                        return date.toISOString().split('T')[0];
                    };
    
                    document.getElementById('modalOrderDate').innerText = formatDate(data.tgl_pesanan);
                    document.getElementById('modalCheckInDate').innerText = formatDate(data.tgl_masuk);
                    document.getElementById('modalCheckOutDate').innerText = formatDate(data.tgl_keluar);
                    document.getElementById('modalServiceType').innerText = data.jenis_pelayanan;
                    document.getElementById('modalTipeLayanan').innerText = data.tipe_layanan;
                    document.getElementById('modalAnimalType').innerText = data.jenis_hewan;
                    document.getElementById('modalSpecies').innerText = data.spesies;
                    document.getElementById('modalQuantity').innerText = data.jumlah;
                    document.getElementById('modalPhone').innerText = data.no_telp;
                    document.getElementById('modalAddress').innerText = data.alamat;
                    document.getElementById('modalMessage').innerText = data.pesan;
                    document.getElementById('modalTotalPrice').innerText = 'Rp ' + parseFloat(data.total_harga).toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    
                    if (data.total_harga !== null && !isNaN(data.total_harga)) {
                        document.getElementById('modalTotalPrice').innerText = 'Rp ' + parseFloat(data.total_harga).toLocaleString('id-ID', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    } else {
                        document.getElementById('modalTotalPrice').innerText = 'Rp 0.00';
                    }

                    var myModal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
                    myModal.show();
                })
                .catch(error => {
                    console.error('Error fetching order details:', error);
                });
        }
    
        let currentOrderId;
    
        function cancelOrder(orderId) {
            currentOrderId = orderId;
            var myModal = new bootstrap.Modal(document.getElementById('cancelReasonModal'));
            myModal.show();
        }
    
        document.addEventListener('DOMContentLoaded', function() {
            var cancelReasonModal = document.getElementById('cancelReasonModal');
            var currentOrderId;

            cancelReasonModal.addEventListener('show.bs.modal', function(event) {
                var button = event.relatedTarget;
                currentOrderId = button.getAttribute('data-order-id');
            });

            document.getElementById('cancelReasonForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const reason = document.getElementById('cancelReason').value;
                fetch(`/pesanan/cancel/${currentOrderId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                }).then(response => {
                    if (response.ok) {
                        alert('Pengajuan pembatalan berhasil. Permintaan Anda sedang diproses. Mohon Ditunggu.');
                        setTimeout(() => {
                            location.reload();
                        }, 5000); // Refresh halaman setelah 5 detik
                    } else {
                        alert('Pengajuan pembatalan gagal, silakan coba lagi.');
                    }
                });
            });
        });
    
        function validateForm() {
            const quantity = document.getElementById('editQuantity').value;
            const phone = document.getElementById('editPhone').value;
            const serviceType = document.getElementById('editServiceType').value;
            const animalType = document.getElementById('editAnimalType').value;
            const species = document.getElementById('editSpecies').value;
            const address = document.getElementById('editAddress').value;
            const message = document.getElementById('editMessage').value;
            const status = document.getElementById('editStatus').value;
    
            if (!quantity || isNaN(quantity) || quantity <= 0) {
                alert('Jumlah harus berupa angka dan lebih besar dari 0.');
                return false;
            }
    
            if (!phone || isNaN(phone)) {
                alert('No Telp harus berupa angka.');
                return false;
            }
    
            if (!serviceType || !animalType || !species || !address || !message || !status) {
                alert('Semua field harus diisi.');
                return false;
            }
    
            return true;
        }
    
        // Set default dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('orderDate').value = today;
        document.getElementById('checkInDate').value = today;
        document.getElementById('orderDate').setAttribute('min', today);
        document.getElementById('checkInDate').setAttribute('min', today);
        document.getElementById('checkOutDate').setAttribute('min', today);
    
        // Validate dates
        document.getElementById('orderDate').addEventListener('change', function() {
            const orderDate = this.value;
            document.getElementById('checkInDate').setAttribute('min', orderDate);
            document.getElementById('checkOutDate').setAttribute('min', orderDate);
        });
    
        document.getElementById('checkInDate').addEventListener('change', function() {
            const checkInDate = this.value;
            document.getElementById('checkOutDate').setAttribute('min', checkInDate);
        });
    
        document.getElementById('confirmOrder').addEventListener('click', function() {
            document.getElementById('paymentSection').classList.remove('hidden');
            startCountdown();
        });
    
        document.getElementById('cancelOrder').addEventListener('click', function() {
            document.getElementById('orderDetails').classList.add('hidden');
            document.getElementById('orderForm').reset();
        });
    
        document.getElementById('cancelPayment').addEventListener('click', function() {
            if (confirm('Apakah Anda yakin ingin membatalkan pembayaran?')) {
                document.getElementById('paymentSection').classList.add('hidden');
                document.getElementById('orderDetails').classList.remove('hidden');
            }
        });
    
        document.getElementById('confirmPayment').addEventListener('click', function() {
            if (confirm('Apakah Anda yakin ingin melakukan pembayaran? Anda tidak dapat membatalkan pembayaran setelah ini. Harap pastikan data yang Anda masukkan sudah benar.')) {
                // Simpan data ke database
                const formData = new FormData(document.getElementById('orderForm'));
                const data = {};
                formData.forEach((value, key) => {
                    data[key] = value;
                });
                data.status = 'success'; // Update status to success
                fetch('/pesanan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => {
                    if (response.ok) {
                        alert('Pembayaran berhasil!');
                        window.location.href = '/pesanan';
                    } else {
                        alert('Pembayaran gagal, silakan coba lagi.');
                    }
                });
            }
        });
    </script>
</body>
</html>